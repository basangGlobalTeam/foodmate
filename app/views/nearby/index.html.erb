<div class="container">
 <div class="row">
   <div class="col-8 offset-2">
     <div class="card">
       <div class="card-body">
         <div class="row">
           <div class="col-4 offset-4">


             <img src="<%= asset_path "loading.gif" %>" alt="" class="img-loading">
             <form action="<%= nearby_index_path %>" id="location" class="d-none">
               <div class="form-group label-floating">
                 <label class="control-label">キロメートル</label>
                 <input class="form-control" placeholder="" type="number" name="km" value="<%= params[:km] ||= 1 %>">

               </div>
               <button class="btn btn-primary btn-md-2 btn-block">検索</button>
             </form>


           </div>
         </div>
       </div>
     </div>
   </div>
   <br>
   <div class="col-8 offset-2">
     <% if @posts %>

       <div id="newsfeed-items-grid">
         <% @posts.each do |post| %>
           <%= render "home/post", post: post %>
         <% end %>
       </div>
       <%= paginate @posts, theme: 'twitter-bootstrap-4', pagination_class: "pagination-sm" %>
   <% end %>
   </div>
 </div>
</div>

<% content_for :map do %>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkDS2qjj7Cg3lTFqxB4cD6jGI1Vjc7bxE&callback=initMap"
          type="text/javascript"></script>

  <script type="text/javascript" charset="utf-8">
    var map, infoWindow;
    function initMap() {
      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          $('#location').append("<input type='hidden' name='lat' value='" + pos.lat + "'/>");
          $('#location').append("<input type='hidden' name='lng' value='" + pos.lng + "'/>");

          $('#location span.waiting').text(pos.lat +"/"+ pos.lng);
          $('.img-loading').hide();
          $('#location').removeClass("d-none")
        }, function() {
          alert("Browser doesn't support Geolocation");
        });
      } else {
        // Browser doesn't support Geolocation
        console.log("Browser doesn't support Geolocation");
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }
  </script>
<% end %>
